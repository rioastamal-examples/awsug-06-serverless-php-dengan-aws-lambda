<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Serverless PHP dengan AWS Lambda - AWS UG Surabaya 06</title>

	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/black.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/monokai.css">

	<style>
		html, body {
			height: 100%;
			/*background-color: #262f3d;*/
		}
		.reveal section img.no-margin {
			margin: 0;
		}
		.reveal section.no-padding {
			padding: 0;
		}
		.red {
			color: #c60000;
		}
		.reveal h3 {
			text-transform: none;
		}
		.reveal pre code.nohighlight {
			background-color: #272822;
		}
	</style>

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement( 'link' );
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>
</head>
<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h3>Serverless PHP <br>dengan AWS Lambda</h3>
			</section>

			<section data-background="img/camp-2.jpg">
				<div style="position: absolute; width: 400px; height: 260px; right: 0; top: 1em; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px;">
					<div style="position: relative; text-align: right; padding-right: 10px;">
						<h3 style="text-transform: none;">Rio Astamal</h3>
						<div style="font-size: 22px;">
							<span style="display: block; width: 60px; float: left;">2019</span> <span>Baby sitter</span><br>
							<span style="display: block; width: 60px; float: left;">2017</span> <span>Lead Backend at ClearView Studios</span><br>
							<span style="display: block; width: 60px; float: left;">2016</span> <span><a style="color: white" href="https://belajaraws.com/">BelajarAWS.com</a></span><br>
							<span style="display: block; width: 60px; float: left;">2015</span> <span>Lead Dev at DominoPOS</span><br>
							<span style="display: block; width: 60px; float: left;">2014</span> <span>System Engineer at WowRack</span>
							<span style="display: block; width: 60px; float: left;">2004</span> <span>Freelance Web Developer</span>
						</div>
					</div>
				</div>
			</section>

			<section>
				<h3>Materi Presentasi dan Kode Demo</h3>
				<p>
					<ul>
						<li><a href="https://rioastamal.net/presentasi/2020/08/awsug-06-serverless-php-dengan-aws-lambda/">https://rioastamal.net/presentasi/2020/08/awsug-06-serverless-php-dengan-aws-lambda/</a></li>
						<li><a href="https://github.com/rioastamal-examples/awsug-06-serverless-php-dengan-aws-lambda">https://github.com/rioastamal-examples/awsug-06-serverless-php-dengan-aws-lambda</a></li>
					</ul>
			</section>


			<section>
				<h3>Apa yang akan kamu pelajari</h3>
				<p>
					<span style="display: inline-block; color: cyan" class="fragment fade-left">{Pengenalan Serverless}</span>
					<span style="display: inline-block" class="fragment fade-left red">{Pengenalan AWS Lambda}</span>
					<span style="display: inline-block; color: yellow" class="fragment fade-up">{Serverless PHP}</span>
					<span style="display: inline-block" class="fragment fade-right">{Serverless Deployment}</span>
					<span style="display: inline-block; color: green" class="fragment fade-down">{Serverless Demo}</span>
					<span style="display: inline-block; color: magenta" class="fragment fade-down">{Profiling Lambda Function}*</span>
				</p>
			</section>

			<section>
				<section data-background="img/dukun-serverless.jpg">
					<div style="position: absolute; width: 400px; top: 1em; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px;">
						<div style="position: relative;">
							<h3 style="text-transform: none;">Apa itu Serverless?</h3>
						</div>
					</div>
				</section>

				<section>
					<h3>Serverless</h3>
					<blockquote style="text-align: left; font-size: 34px;">Menjalankan kode aplikasi tanpa perlu memikirkan server (autoscaling dkk).</blockquote>
					<blockquote style="text-align: left; font-size: 34px;">Dalam konteks ini adalah Function as a Service (FaaS).</blockquote>
				</section>

				<section>
					<h3>Keuntungan Serverless</h3>
					<p>
						<span style="display: inline-block; color: cyan" class="fragment fade-left">{Zero Administration}</span>
						<span style="display: inline-block" class="fragment fade-left red">{Bayar per Eksekusi}</span>
						<span style="display: inline-block; color: yellow" class="fragment fade-up">{Idle = Gratis}</span>
						<span style="display: inline-block" class="fragment fade-right">{Auto-Scaling}</span>
						<span style="display: inline-block; color: green" class="fragment fade-down">{Microservice sejak awal}</span>
						<span style="display: inline-block; color: red" class="fragment fade-left">{Event-Driven}</span>
						<span style="display: inline-block; color: magenta" class="fragment fade-up">{Faster time to market}</span>
					</p>
				</section>
			</section>

			<section>
				<section>
					<h3>AWS Lambda</h3>
					<blockquote>Layanan Serverless dari AWS yang mendukung penggunaan kode NodeJS, Python, Java, Go, .NET Core, Ruby dan <strong style="text-decoration: underline;">Custom Runtime</strong>.</blockquote>

					<blockquote>Biaya dihitung per 100ms durasi waktu dan &Sigma; eksekusi.</blockquote>
				</section>

				<section>
					<h3>Cara Kerja Lambda</h3>
					<img src="img/lambda-how-it-works.png">
				</section>

				<section>
					<h3>Lambda Runtime</h3>
					<blockquote>Gabungan dari sistem operasi, bahasa pemrograman dan pustaka-pustaka lain yang dibutuhkan untuk menjalankan kode.</blockquote>
				</section>

				<section>
					<h3>Contoh Kode Python</h3>
					<pre><code data-trim>
def my_handler(event, context):
  return {
    "message": "Hello World"
  }
					</code></pre>
				</section>
			</section>

			<section>
				<section>
					<h3>Bagaimana dengan Runtime PHP di AWS Lambda?</h3>
					<p>
						<span style="display: block; color: yellow" class="fragment fade-left">Tidak ada :(</span>
						<span style="display: block; color: cyan" class="fragment fade-right">#justkidding</span>
					</p>
				</section>

				<section>
					<h3>Perkenalkan Bref PHP</h3>
					<blockquote>Bref adalah Runtime PHP, Framework dan deployment tool agar PHP dapat dijalankan di AWS Lambda.</blockquote>
				</section>

				<section>
					<h3>Bref PHP Runtime</h3>
					<p>Dibuat dari <span style="background-color:yellow; border-radius: 6px; padding: 2px 8px; color: black;">amazonlinux:2018.03</span> Docker image</p>
					<table>
						<thead>
							<tr>
								<th>Layer</th>
								<th>Cocok untuk</th>
							</tr>
						</thead>
						<tbody>
							<tr style="color: cyan">
								<td>php-*</td>
								<td>PHP Function (from scratch)</td>
							</tr>
							<tr style="color: yellow">
								<td>php-*-fpm</td>
								<td>Website/Framework</td>
							</tr>
							<tr style="color: magenta">
								<td>console</td>
								<td>Console (CLI)</td>
							</tr>
						</tbody>
						</tbody>
					</table>
				</section>

				<section>
					<h3>Konsep Eksekusi Custom Runtime</h3>
				</section>

				<section data-background-color="white">
					<img style="box-shadow: none" src="img/lambda-runtime-concept.jpg">
				</section>
			</section>

			<section>
				<section>
					<h3>Saatnya Demo</h3>
				</section>

				<section>
					<h3>Serverless Demo App</h3>
					<table style="font-size: 32px;">
						<thead>
							<tr>
								<td>App</td>
								<td>Tipe</td>
								<td>Lambda Layer</td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Terbilang</td>
								<td>HTTP API</td>
								<td>bref php-73</td>
							</tr>
							<tr>
								<td>SQL Query Browser</td>
								<td>Normal Web</td>
								<td>bref php-73-fpm</td>
							</tr>
							<tr>
								<td>New File Notification*</td>
								<td>S3 Event</td>
								<td>bref php-73</td>
							</tr>
							<tr style="text-decoration: line-through solid red;">
								<td>What is My IP*</td>
								<td>HTTP API + Normal Web</td>
								<td>bref php-73</td>
							</tr>
						</tbody>
					</table>
					<p style="font-size: 30px;">*) Hanya menggunakan Bref PHP Runtime tanpa Bref Framework</p>
				</section>
			</section>

			<section>
				<section>
					<h3>Demo App - Terbilang</h3>
					<blockquote>Sebuah layanan HTTP API yang akan mengubah angka "123" menjadi bentuk terbilang "seratus dua puluh tiga".</blockquote>
				</section>

				<section>
					<h3>Install Bref dan Pustaka Terbilang</h3>
					<pre><code>$ cat composer.json</code></pre>
					<pre><code data-trim>
{
  "require": {
	"bref/bref": "^0.5.29",
	"rioastamal/terbilang": "^1.0"
  }
}
					</code></pre>

					<pre><code data-trim>
						$ composer install -vvv
					</code></pre>
				</section>

				<section>
					<h3>Inisialisasi Bref PHP</h3>
					<pre><code data-trim>
						$ ./vendor/bin/bref init
					</code></pre>

					<pre><code data-trim>
 What kind of lambda do you want to create? (you will be able to add more functions later by editing `serverless.yml`) [PHP function]:
  [0] PHP function
  [1] HTTP application
  [2] Console application
 > 0
					</code></pre>
				</section>

				<section>
					<h3>File Handler index.php</h3>
					<pre><code data-trim>
&lt;?php declare(strict_types=1);

require __DIR__ . &apos;/vendor/autoload.php&apos;;

use RioAstamal\AngkaTerbilang\Terbilang;

/**
 * @param array $event
 * @see https://docs.aws.amazon.com/lambda/latest/dg/services-apigateway.html for example
 * @return callable
 */
return function ($event)
{
	$angka = $event[&apos;queryStringParameters&apos;][&apos;angka&apos;] ?? &apos;0&apos;;
	$options = isset($event[&apos;queryStringParameters&apos;][&apos;pretty&apos;]) ? JSON_PRETTY_PRINT : 0 ;

	$response = [
		&apos;angka&apos; =&gt; $angka,
		&apos;terbilang&apos; =&gt; Terbilang::create()-&gt;t($angka)
	];

	return json_encode($response, $options);
};
					</code></pre>
				</section>

				<section>
					<h3>Deploy Fungsi ke AWS Lambda</h3>
					<pre><code data-trim>
						$ serverless deploy
					</code></pre>
				</section>

				<section>
					<h3>Memanggil Terbilang API</h3>
					<pre><code data-trim>
$ curl --get -d 'angka=1500,004,300' -d 'pretty' [END_POINT]
					</code></pre>
					<pre><code data-trim>
{
	"angka": "1500,004,300",
	"terbilang": "satu milyar lima ratus juta empat ribu tiga ratus"
}
					</code></pre>
				</section>
			</section>

			<section>
				<section>
					<h3>Demo App - SQL Query Browser</h3>
					<blockquote>Sebuah web app untuk melakukan query pada MySQL dan menampilkan hasilnya secara langsung.</blockquote>
				</section>

				<section>
					<h3>Provision Amazon RDS MySQL</h3>
					<pre><code data-trim>
$ cd terraform/
$ export AWS_PROFILE=YOUR_PROFILE AWS_DEFAULT_REGION=YOUR_REGION
$ terraform apply</code></pre>

					<pre><code data-trim>
Outputs:

database = {
  "connect" = "mysql -u awsug -h [HOST_NAME] -p serverlessphp"
  "endpoint" = "[HOST_NAME]:3306"
  "engine" = "mysql 5.7.26"
}
					</code></pre>
				</section>

				<section>
					<h3>Install Bref</h3>
					<pre><code>$ cat composer.json</code></pre>
					<pre><code data-trim>
{
  "require": {
	"bref/bref": "^0.5.29",
  }
}
					</code></pre>

					<pre><code data-trim>
						$ composer install -vvv
					</code></pre>
				</section>

				<section>
					<h3>Inisialisasi Bref PHP</h3>
					<pre><code data-trim>
						$ ./vendor/bin/bref init
					</code></pre>

					<pre><code data-trim class="nohighlight">
 What kind of lambda do you want to create? (you will be able to add more functions later by editing `serverless.yml`) [PHP function]:
  [0] PHP function
  [1] HTTP application
  [2] Console application
 > 1
					</code></pre>
				</section>

				<section>
					<h3>File Handler index.php</h3>
					<pre><code data-trim>
&lt;?php

$dsn = $_POST[&apos;dsn&apos;] ?? &apos;&apos;;
$username = $_POST[&apos;username&apos;] ?? &apos;root&apos;;
$password = $_POST[&apos;password&apos;] ?? &apos;&apos;;
$query = $_POST[&apos;query&apos;] ?? &apos;&apos;;
$pdo = null;

function exec_query($pdo, $query)
{
	if (empty($query)) {
		return &apos;// Result will be shown here&apos;;
	}

	$counter = 0;

	try {
		echo &apos;&lt;table&gt;&apos;;
		foreach ($pdo-&gt;query($query, PDO::FETCH_ASSOC) as $row) {
			// --- HEADING --- //
			if ($counter === 0) {
				echo &apos;&lt;thead&gt;&lt;tr&gt;&apos;;

				foreach ($row as $key =&gt; $val) {
					printf(&apos;&lt;td&gt;%s&lt;/td&gt;&apos;, $key);
				}

				echo &apos;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&apos;;
			}
			// --- /HEADING --- //

			echo &apos;&lt;tr&gt;&apos;;
			foreach ($row as $val) {
				printf(&apos;&lt;td&gt;%s&lt;/td&gt;&apos;, $val);
			}
			echo &apos;&lt;/tr&gt;&apos;;

			$counter++;
		}

		echo &apos;&lt;/tbody&gt;&lt;/table&gt;&apos;;
	} catch (PDOException $e) {
		printf(&apos;&lt;pre&gt;Error: %s&lt;/pre&gt;&apos;, $e-&gt;getMessage());
	}
}

if ($dsn) {
	try {
		$pdo = new PDO($dsn, $username, $password);
		$pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
	} catch (PDOException $e) {
		echo &apos;Connection failed: &apos; . $e-&gt;getMessage();
	}
}

?&gt;&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
	&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt;
	&lt;title&gt;Query Browser on AWS Lambda&lt;/title&gt;
	&lt;style type=&quot;text/css&quot;&gt;
		label {
			display: block;
		}
		div.label-wrapper {
			width: 300px;
		}
		table {
			border-collapse: collapse;
			width: 100%;
		}
		thead td {
			background-color: #f1f1f1;
			font-weight: bold;
		}
		tr td {
			border: 1px solid #ccc;
			padding: 4px 8px;
		}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;h2&gt;Query Browser on AWS Lambda&lt;/h2&gt;
	&lt;form method=&quot;post&quot;&gt;
		&lt;label&gt;MySQL DSN&lt;/label&gt;
		&lt;input type=&quot;text&quot; name=&quot;dsn&quot; placeholder=&quot;mysql:dbname=testdb;host=127.0.0.1&quot; style=&quot;width: 300px;&quot; value=&quot;&lt;?= $dsn ?&gt;&quot;&gt;
		&lt;label&gt;Username / Password&lt;/label&gt;
		&lt;input type=&quot;text&quot; name=&quot;username&quot; placeholder=&quot;MySQL Username&quot; value=&quot;&lt;?= $username; ?&gt;&quot;&gt;
		&lt;input type=&quot;password&quot; name=&quot;password&quot; placeholder=&quot;MySQL Password&quot; value=&quot;&lt;?= $password; ?&gt;&quot;&gt;

		&lt;br&gt;&lt;br&gt;
		&lt;label&gt;SQL Query&lt;/label&gt;
		&lt;textarea style=&quot;width: 99%;height: 200px; font-size: 24px; color: blue;&quot; name=&quot;query&quot;&gt;&lt;?= htmlentities($query) ?&gt;&lt;/textarea&gt;
		&lt;input type=&quot;submit&quot; value=&quot;RUN&quot;&gt;
	&lt;/form&gt;

	&lt;hr&gt;
	&lt;?php exec_query($pdo, $query) ?&gt;
&lt;/body&gt;
&lt;/html&gt;
					</code></pre>
				</section>

				<section>
					<h3>Deploy Web ke AWS Lambda</h3>
					<pre><code data-trim>
						$ serverless deploy
					</code></pre>
				</section>

				<section>
					<a href="img/query-browser-demo.png"><img src="img/query-browser-demo.png"></a>
				</section>

			</section>

			<section>
				<section>
					<h3>Demo App - S3 New File Notification</h3>
					<blockquote>Sebuah fungsi Lambda yang akan mengirimkan notifikasi ke email jika ada file baru pada bucket tertentu.</blockquote>
				</section>

				<section>
					<h3>Memaket Lambda</h3>
					<pre><code data-trim>
                        $ bash build.sh
					</code></pre>

                    <pre><code class="nohighlight">&gt; Creating zip file into build/function.zip ...
Generating autoload files
Generated autoload files
&lt; Lambda function has been zipped.</code></pre>
				</section>

				<section>
					<h3>Deploy Infra dan Lambda</h3>
					<pre><code data-trim>
				    	$ bash deploy.sh
					</code></pre>

					<pre><code data-trim>...
Outputs:

demo = {
  "mailhog" = {
    "ec2_ip" = "18.139.0.199"
    "mailhog_auth" = "user = teknocerdas | password = orang.cerdas"
    "ssh_access" = "ssh -i ~/.ssh/teknocerdas.key -o LogLevel=quiet -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null ubuntu@18.139.0.199"
    "url" = "https://mailhog.teknocerdas.com"
  }
  "s3_bucket" = {
    "butcket_name" = "awsug06-sub-demo"
    "create_example" = "aws s3 cp ./YOUR_FILE.ext s3://awsug06-sub-demo/"
  }
}
					</code></pre>
				</section>

				<section>
					<section>Bootstrap File</section>
					<pre><code data-trim>
#!/bin/sh
# Main entry point for Lambda execution

# Fail on error
set -e

# Outer main loop for execution.
# So if there's next event it will get execute it immediately
while true
do
  # All errors to STDOUT so it can be captured to CloudWatch
  /opt/bin/php "$_HANDLER" 2&gt;&1
done
                    </code></pre>
                </section>

                <section>
                    <h3>File src/LambdaRuntime.php</h3>
                    <pre><code><script type="text/template"><?php
namespace App;

use App\Handler;

class LambdaRuntime
{
  /**
   * Create object from static calls
   *
   * @return App\LambdaRuntime
   */
  public static function create()
  {
    return new static();
  }

  /**
   * Simple abstraction for HTTP GET Lambda invocation
   *
   * @param String $url
   * @return Array
   */
  public function fetch($url)
  {
    $headers = [
      'Content-Type: application/json',
      'User-Agent: BelajarAWS/1.0',
      'Accept: application/json'
    ];
    $options = [
      'http' => [
        'method' => 'GET',
        'header' => implode("\r\n", $headers)
      ]
    ];
    $context = stream_context_create($options);
    $response = file_get_contents($url, false, $context);

    // Parse special variables called $http_response_header
    $requestId = null;

    foreach ($http_response_header as $value) {
      if (preg_match('/Lambda-Runtime-Aws-Request-Id/', $value)) {
        $requestId = trim(explode('Lambda-Runtime-Aws-Request-Id:', $value)[1]);
      }
    }

    return [
      'body' => json_decode($response, $toArray = true),
      'request_id' => $requestId
    ];
  }

  /**
   * Simple abstraction for HTTP POST
   *
   * @param String $url
   * @param String $data
   * @return String
   */
  public function post($url, $data)
  {
    $headers = [
      'Content-Type: application/json',
      'User-Agent: BelajarAWS/1.0',
      'Content-Length: ' . strlen($data)
    ];
    $options = [
      'http' => [
        'method' => 'POST',
        'header' => implode("\r\n", $headers),
        'content' => $data
      ]
    ];

    $context = stream_context_create($options);
    return file_get_contents($url, false, $context);
  }

  /**
   * Lambda main loop
   */
  public function main()
  {
    // AWS_LAMBDA_RUNTIME_API are automatically set by Lambda
    $lambdaRuntimeApi = getenv('AWS_LAMBDA_RUNTIME_API');
    $lambdaBaseUrl = sprintf('http://%s/2018-06-01/runtime/invocation/', $lambdaRuntimeApi);
    $maxLoop = getenv('MAX_LOOP') ?: 10;
    $currentLoop = 0;
    $handler = Handler::create();

    // Inner main loop for execution.
    // So if there's next event it will get execute it immediately
    while (true)
    {
      if (++$currentLoop > $maxLoop) {
        break;
      }

      $nextEvent = $this->fetch($lambdaBaseUrl . 'next');
      $handlerResponse = $handler->handle($nextEvent['body']);

      $responseUrl = sprintf('%s%s/response', $lambdaBaseUrl, $nextEvent['request_id']);
      $lambdaResponse = $this->post($responseUrl, $handlerResponse);
    }
  }
}</script></code></pre>
				</section>

				<section>
					<h3>File src/Handler.php</h3>
					<pre><code data-trim><script type="text/php"><?php
/**
 * Lambda function to handle notification from S3 event and then
 * send the info via email (SMTP).
 */
namespace App;
use Tx\Mailer;

class Handler
{
  /**
   * @var array $config - Configuration for the Handler such as
   *      region, endpoint, etc.
   */
  public $config = [];

  /**
   * Constructor
   *
   * @param array $config
   * @return void
   */
  public function __construct(array $config = [])
  {
    $default = [
      'region'      => 'ap-southeast-1',
      'version'     => 'latest',
      'email_addr'  => getenv('AWSUG_EMAIL') ? getenv('AWSUG_EMAIL') : 'rio@rioastamal.net',
      'smtp'        => [
        'host' => getenv('AWSUG_SMTP_HOST') ? getenv('AWSUG_SMTP_HOST') : 'rio@rioastamal.net',
        'port' => getenv('AWSUG_SMTP_PORT') ? getenv('AWSUG_SMTP_PORT') : 587,
        'username' => getenv('AWSUG_SMTP_USER') ? getenv('AWSUG_SMTP_USER') : null,
        'password' => getenv('AWSUG_SMTP_PASSWD') ? getenv('AWSUG_SMTP_PASSWD') : null,
      ]
    ];

    $this->config = array_replace_recursive($default, $config);
  }

  /**
   * Create object from static calls
   *
   * @param array $config
   * @return App\Handler
   */
  public static function create(array $config = [])
  {
    return new static($config);
  }

  /**
   * Handler function which return a response and will be send back to Lambda
   *
   * @param array $event Lambda Event
   * @return String
   */
  public function handle($event)
  {
    $eventTime = $event['Records'][0]['eventTime'];
    $body = sprintf('<h3>Here is the the event info.</h3><pre>%s</pre>', json_encode($event, JSON_PRETTY_PRINT));

    // Send email notification for new file
    $mailer = (new Mailer())
        ->setServer($this->config['smtp']['host'], $this->config['smtp']['port'])
        ->setFrom('Rio Astamal', 'rio@rioastamal.net')
        ->addTo('AWS UG Surabaya', $this->config['email_addr'])
        ->setSubject( sprintf('New file has been uploaded at %s', $eventTime) )
        ->setBody($body)
        ->send();

    $response = [
        'email_status' => (bool)$mailer,
        'requestId' => $event['Records'][0]['responseElements']['x-amz-request-id']
    ];
    return json_encode($response);
  }
}
</script>
					</code></pre>
				</section>

				<section>
					<h3>Test Email Notification</h3>
					<pre><code class="nohighlight">$ aws s3 cp /some/file.ext s3://[BUCKET_NAME]/</code></pre>
				</section>
			</section>

			<section>
				<a href="img/file-notification-demo.png"><img src="img/file-notification-demo.png"></a>
			</section>

			<section>
				<h3>./end</h3>
				<ul style="list-style: none">
					<li><img src="img/wwwlogo.png" style="background-color: white; border-radius: 4px; margin: 0; height: 40px; margin-right: 10px; position: relative; top: 0.2em;">Website <a href="https://rioastamal.net">rioastamal.net</a></li>
					<li><img src="img/email-logo.png" style="background-color: white; border-radius: 4px; margin: 0; height: 40px; margin-right: 10px; position: relative; top: 0.2em;">Email <a href="mailto:rio@rioastamal.net">rio@rioastamal.net</a></li>
					<li><img src="img/linkedin-logo.png" style="background-color: white; border-radius: 4px; margin: 0; height: 40px; margin-right: 10px; position: relative; top: 0.2em;">LinkedIn <a href="https://linkedin.com/in/rioastamal">linkedin.com/in/rioastamal</a></li>
					<li><img src="img/github-logo.png"   style="background-color: white; border-radius: 4px; margin: 0; height: 40px; margin-right: 10px; position: relative; top: 0.2em;">Github <a href="https://github.com/rioastamal">github.com/rioastamal</a></li>
				</ul>
			</section>
		</div>
	</div>

	<script src="js/reveal.js"></script>

	<script>
	var hostname = window.location.hostname,
		port = 9191,
		ws = null,
		webSocketTimer = null,
		reconnectInterval = 3;

		function startConnection()
		{
			try {
				ws = new WebSocket('ws://' + hostname + ':' + port);

				ws.onmessage = function(e) {
					try {
						var messageObject = JSON.parse(e.data);
						Reveal.setState(messageObject.state);
					} catch (e) {
						// bad json
					}
				};

				ws.onclose = function(e) {
					console.log('WebSocket disconnected, retry connection in ' + reconnectInterval + ' seconds...');
					ws = null;
					clearTimeout(webSocketTimer);
					webSocketTimer = setTimeout(function() {
						startConnection();
					}, reconnectInterval * 1000);
				};
			} catch (e) {
				ws = null;
			}
		}

		function sendPacket(websocket, data)
		{
			if (!websocket) { return; }

			websocket.send(data);
		}

		window.addEventListener('load', function() {
			// startConnection();

			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				hash: true,
				controls: true,
				dependencies: [
					{ src: 'plugin/highlight/highlight.js' }
				]
			});

			var packetFn = function(op, e) {
				return {
					operation: op,
					state: Reveal.getState(),
					qs: window.location.search
				};
			};

			var totalSlide = Reveal.getTotalSlides();

			Reveal.addKeyBinding(66, function(e) {
				Reveal.togglePause();
				sendPacket(ws, JSON.stringify( packetFn('togglepause', e) ));
			});

			Reveal.addKeyBinding(65, function(e) {
				Reveal.slide(0, 0, 0);
				sendPacket(ws, JSON.stringify( packetFn('firstslide', e) ));
			});

			Reveal.addKeyBinding(90, function(e) {
				Reveal.slide(totalSlide, 0, 0);
				sendPacket(ws, JSON.stringify( packetFn('lastslide', e) ));
			});

			Reveal.addEventListener('slidechanged', function(e) {
				sendPacket(ws, JSON.stringify( packetFn('slidechanged', e) ));
			});

			Reveal.addEventListener('fragmentshown', function(e) {
				sendPacket(ws, JSON.stringify( packetFn('fragmentshown', e) ));
			});

			Reveal.addEventListener('fragmenthidden', function(e) {
				sendPacket(ws, JSON.stringify( packetFn('fragmenthidden', e) ));
			});
		});
	</script>
</body>
</html>
